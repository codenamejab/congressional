<!DOCTYPE html>
<html>
<head>
<style>
div.a {
    text-align: center;
}
</style>
</head>
<body>

<div class = "a" id = "myDIV">
<h1 id="TB" style = "color:black;">Hit the target!</h1>
<h2 style = "color:black;">Using the input box below, write the equation of the target in (x - h)^2 + (y - k)^2 = r^2 form</h2>
<h3 id="nums"></h3>

<br>

<input type="text" id="ans"> </input>
<button onclick="checkAns()" id="btn"> Check </button>

<br>
<br>
<br>
<br>

<canvas id = "myCanvas" width = "600" height = "600" style = "border:1px solid #d3d3d3;">
</canvas>
<img id = "targetpic" src = "archerygame/assets/target.png" style = "display: none;">
<!-- <img id = "arrowpic" src = "archerygame/assets/arrow.png" style = "display: none"> -->
<script>
var target = document.getElementById("targetpic");
arrow = new Image();
arrow.src = 'archerygame/assets/arrow.png';
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");
ctx.clearRect(0, 0, myCanvas.width, myCanvas.height);
var centerx = 1;//Math.floor(Math.random() * 17) - 8;
while(centerx == 0) {
    centerx = Math.floor(Math.random() * 17) - 8;
}
var centery = 1;//Math.floor(Math.random() * 17) - 8;
while(centery == 0) {
    centery = Math.floor(Math.random() * 17) - 8;
}
var radius = 0;
calculateRadius();
drawTarget();
drawGraph();

function calculateRadius() {
    var possibles = [60, 120, 180, 240, 300, 360, 420];
    var restrict = 10 - Math.max(Math.abs(centerx), Math.abs(centery));
    if(restrict >= 7) var randindex = Math.floor(Math.random() * 7);
    else var randindex = Math.floor(Math.random() * restrict);
    radius = possibles[randindex];
    document.getElementById("nums").innerHTML = centerx + " " + centery + " " + (radius / 60);
}

function drawTarget() {
    ctx.drawImage(target, (centerx + 10) * 30 - (radius / 2) - (radius / 30), -30 * centery + 300 - (radius / 2) - (radius / 30), radius + (radius / 30) * 2, radius + (radius / 30) * 2);
    //ctx.drawImage(target, 0, 0, 100, 100);
}

ctx.drawImage(arrow, 0, 0, 10, 10);

function drawGraph() {
    //vert lines
    for(var i = 1; i <= 21; i++) {
        ctx.lineWidth = 0.5;
        if(i == 10) ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(i * 30, 0);
        ctx.lineTo(i * 30, 600);
        ctx.stroke();
    }

    //horz lines
    for(var i = 1; i <= 21; i++) {
        ctx.lineWidth = 0.5;
        if(i == 10) ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(0, i * 30);
        ctx.lineTo(600, i * 30);
        ctx.stroke();
    }
}

function checkAns() {
    var text = document.getElementById("ans").value;
    try {
        if(!text.includes("y")) {
            throw "No \"y\" detected!"
        }
        if(!text.includes("=")) {
            throw "No equal sign detected!"
        }
        if(!text.includes("x")) {
            throw "No \"x\" sign detected!"
        }
    } catch(e) {
        alert("ERROR = " + e)
        return
    }
    var h = 0;
    var k = 0;
    var r = 0;
    var newstr = "";
    for(var i = 0; i < text.length; i++) {
        if(text.charAt(i) != ' ') newstr+=text.charAt(i);
    }
    //document.getElementById("nums").innerHTML = newstrnospace;
    document.getElementById("nums").innerHTML = newstr;
    try {
        if(newstr.substring(0, 2) != '(x') {
            throw "invalid syntax!x"
        }
        //( x + 8 ) ^ 2 + ( y - 9 ) ^ 2 = 4 9
        //0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7
        //x ^ 2 + y ^ 2 = 9
        if(newstr.substring(4, 10) != ')^2+(y') {
            throw "invalid syntax!y"
        }
        if(newstr.substring(12, 16) != ')^2=') {
            throw "invalid syntax!end"
        }
        if(newstr.substring(newstr.length - 2, newstr.length) == '^2') {
            throw "simplify your radius!"
        }
    } catch(e) {
        alert("ERROR  = " + e)
        return
    }
    h = parseInt(newstr.substring(2, 4)) * -1;
    k = parseInt(newstr.substring(10, 12)) * -1;
    r = Math.sqrt(parseInt(newstr.substring(16, newstr.length)));
    //document.getElementById("nums").innerHTML = h + " " + centerx + " " + k + " " + centery + " " + r + " " + (radius/30);

    if(h == centerx && k == centery && r == radius / 60) {
        animate();
    } else {
        alert("Incorrect! Please try again!")
        return
    }

    var fps = 60;
    var percent = 0;
    var direction = 1;
    var swish = 0;

    function animate() {

// set the animation position (0-100)
percent += direction;
if (percent < 0) {
    percent = 0;
    direction = 1;
};

draw(percent);

if (percent < 100){
// request another frame
setTimeout(function () {
    requestAnimationFrame(animate);
}, 1000 / fps);

}
}


// draw the current frame based on sliderValue
function draw(sliderValue) {

// redraw path
ctx.clearRect(0, 0, canvas.width, canvas.height);

ctx.lineWidth = 5;



ctx.strokeStyle = 'black';
drawTarget();
drawGraph();


//show start point


ctx.strokeStyle = 'rgb(0,255,0)'
ctx.fillStyle = 'blue'   
ctx.beginPath();
ctx.arc(660,480,5,0,6.28);
ctx.fill();
ctx.strokeStyle= "black"; 
ctx.lineWidth = 2;
ctx.font = "bold 30px Arial"
ctx.fillText("Start your shot here", 540,445)
ctx.strokeText("Start your shot here", 540,445)
//arrow; determine results
if(swish == 1){
    ctx.fillStyle = 'rgb(0,255,255)'
    ctx.font = "bold 120px Times New Roman"
    ctx.fillText("Swish!", 300,250)
}
else if(swish == 2){
    ctx.fillStyle = 'rgb(255,0,0)'
    ctx.font = "bold 40px Times New Roman"
    ctx.fillText("You stepped past the line!", 230, 350)
}
else if(swish == 3){
    ctx.fillStyle = 'rgb(0,255,255)'
    ctx.font = "bold 120px Times New Roman"
    ctx.fillText("Swiiiish!", 230,250)      
}
else if(swish == 4){
    ctx.fillStyle = 'rgb(255,0,0)'
    ctx.font = "bold 40px Times New Roman"
    ctx.fillText("You missed!", 350, 350)
}

if(percent == 100 || percent == 0){
  swish = 0
}


// draw the tracking rectangle
var xy;
    var point1X = 600;
    var point1Y = 0;
    var point2X = h;
    var point2Y = k;
    // this has to be 25
    var percent = (sliderValue) / 25
    xy = getQuadraticBezierXYatPercent({
        x: point1X,
        y: point1Y
    }, {
        x: point2X,
        y: point2Y
    }, percent/4);
    //might have to change percent^^
//this is to see where ball lands and not have it go on past hoop


//if((xy.x<= 165 - ball.width * .6 / 2 ) && (xy.x >= 60 - ball.width * .6 / 2) && (xy.y >=60 - ball.height * .6 / 2) && (xy.y <= 150 - ball.height * .6 / 2)){
  //drawRect(xy, "red")
 // alert("yu in")
  



drawRect(xy, "red");



   //check if they made it or not; swish
   if(point1X >= 600 && point1X <= 720 && xy.x <= 197 && xy.x >= 187 && xy.y >= 30 && xy.y <= 150 ) {
    console.log("Swish")
    swish = 1;
 }
  else if(point1X <= 600 || point1X >= 720){
    swish = 2;
    console.log("travelled while shooting")
  }
  else if(slope >= 15 && xy.x <= 180 && xy.x >= 60){
    swish = 3;
    console.log("Swiiiiish")

  }
  else if(slope <15 && xy.x <= 197 && xy.x >= 187 && (xy.y <= 30 || xy.y >= 150)){
    swish = 4
    console.log("BRICK")

  }


}


// draw tracking rect at xy
function drawRect(point, color) {
ctx.fillStyle = "cyan";
ctx.strokeStyle = "gray";
ctx.lineWidth = 3;  

ctx.save();
ctx.beginPath();
//make a narrow rectangle
ctx.arc(point.x, point.y, 55, 0, 6.28, false); //draw the circle
ctx.clip(); //call the clip method so the next render is clipped in last path
ctx.closePath();



//                                       mess around with numbers
ctx.drawImage(arrow, point.x - arrow.width * .6 / 2, point.y - arrow.height * .6 / 2, arrow.width * 0.6, arrow.height * 0.6);

ctx.restore();


//ctx.rect(point.x - 13, point.y - 8, 25, 15);

}

// quadratic bezier: percent is 0-1
function getQuadraticBezierXYatPercent(h, k, percent) {
var x = 600 - h;
x = x / 100 * percent;
var y = 0 + k;
y = y / 100 * percent;
return ({
    x: x,
    y: y
});
}

}

</script>
<br>
<br>

<button type = "button" onclick = "refresh()" id = "newq"> New Question </button>
<script>
function refresh() {
    location.reload();
    return false;
}
</script>

</div>

</body>
</html>
